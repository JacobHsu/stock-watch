<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TSM Stock Technical Analysis</title>
    <link rel="icon" type="image/png" href="../icons/tsm.svg">
    <link rel="stylesheet" href="../styles.css" />

    <script>
      // 載入超時檢查和錯誤處理
      let tvTimeout = setTimeout(() => {
        if (typeof TradingView === "undefined") {
          document.querySelectorAll('[id^="tradingview_"]').forEach((el) => {
            el.innerHTML =
              '<div class="fallback-content"><p>圖表暫時無法載入</p><button onclick="location.reload()">重新載入</button></div>';
          });
        }
      }, 10000);

      window.addEventListener("load", () => clearTimeout(tvTimeout));
    </script>

    <!-- 使用 defer 載入腳本，加上錯誤處理 -->
    <script
      defer
      src="https://s3.tradingview.com/tv.js"
      onerror="document.querySelectorAll('[id^=tradingview_]').forEach(el => el.innerHTML='<div class=fallback-content><p>圖表載入失敗</p><button onclick=location.reload()>重新載入</button></div>')"
    ></script>
    <script defer src="../chart-config.js"></script>
  </head>
  <body>
    <div class="charts-grid-3x4" data-symbol="NYSE:TSM" data-prefix="tsm">
      <!-- 第一行 - 1小時 -->
      <div id="tradingview_tsm_1h_col1"></div>
      <div id="tradingview_tsm_1h_col2"></div>
      <div id="tradingview_tsm_1h_col3"></div>
      <div id="tradingview_tsm_1h_col4"></div>

      <!-- 第二行 - 4小時 -->
      <div id="tradingview_tsm_4h_col1"></div>
      <div id="tradingview_tsm_4h_col2"></div>
      <div id="tradingview_tsm_4h_col3"></div>
      <div id="tradingview_tsm_4h_col4"></div>

      <!-- 第三行 - 1天 -->
      <div id="tradingview_tsm_1d_col1"></div>
      <div id="tradingview_tsm_1d_col2"></div>
      <div id="tradingview_tsm_1d_col3"></div>
      <div id="tradingview_tsm_1d_col4"></div>
    </div>

    <script>
      // 顯示載入狀態
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('[id^="tradingview_"]').forEach((el) => {
          el.innerHTML = '<div class="loading-placeholder"></div>';
        });
      });
    </script>
  </body>
</html>
